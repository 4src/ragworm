<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>lib API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<link rel="preconnect" href="https://www.google.com">
<script async src="https://cse.google.com/cse.js?cx=017837193012385208679:pey8ky8gdqw"></script>
<style>
.gsc-control-cse {padding:0 !important;margin-top:1em}
body.gsc-overflow-hidden #sidebar {overflow: visible;}
</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
&nbsp;
&nbsp;
<a href="https://github.com/4src/ragworm/blob/master/README.md"> <img
src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width=35></a>
&nbsp;
<a href="ragworm.html">ragworm.py</a>
:: <a href="lib.html">lib.py</a>
:: <a href="tests.html">tests.py</a>
<br clear=all>
<hr>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>lib</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># vim: set ts=2:sw=2:et:
import re
import ast
import sys
import math
import random
import traceback
from copy import deepcopy
from pyfiglet import Figlet
from termcolor import colored
from copy import deepcopy
from functools import cmp_to_key

seed = random.seed
r    = random.random

inf  = sys.maxsize / 2
ninf = -inf + 1
#------------------------------------------------ --------- --------- ----------
def figfont(txt,font):
  return Figlet(font=font).renderText(txt)

def yell(s,c):
  print(colored(s,&#34;light_&#34;+c,attrs=[&#34;bold&#34;]),end=&#34;&#34;)

def showd(d): return &#34;{&#34;+(&#34; &#34;.join([f&#34;:{k} {show(v)}&#34;
                         for k,v in d.items() if k[0]!=&#34;_&#34;]))+&#34;}&#34;

def show(x):
  if callable(x)         : return x.__name__+&#39;()&#39;
  if isinstance(x,float) : return f&#34;{x:.2f}&#34;
  return x
#------------------------------------------------ --------- --------- ----------
class BAG(dict):
  __getattr__ = dict.get
  __setattr__ = dict.__setitem__
  __delattr__ = dict.__delitem__
  __repr__    = showd
#------------------------------------------------ --------- --------- ----------
def per(a, p=.5, key=lambda x:x):
  p=int(len(a)*p); p=max(0,min(len(a)-1,p)); return key(a[p])

def median(a, key=lambda x:x):
  return key(per(a,.5))

def stdev(a, key=lambda x:x):
  return (key(per(a,.9)) - key(per(a,.1)))/2.56

def ent(d):
  n = sum(( d[k] for k in d))
  return -sum((d[k]/n*math.log(d[k]/n,2) for k in d if d[k]&gt;0))
#------------------------------------------------ --------- --------- ----------
def csv(file):
  with open(file) as fp:
    for line in fp:
      line = re.sub(r&#39;([\n\t\r&#34;\&#39; ]|#.*)&#39;, &#39;&#39;, line)
      if line:
        yield [coerce(cell.strip()) for cell in line.split(&#34;,&#34;)]

def coerce(x):
  if x==&#34;?&#34;: return x
  try: return ast.literal_eval(x)
  except: return x

def settings(help, update=False):
  &#34;Parses help string for lines with flags (on left) and defaults (on right)&#34;
  d={}
  for m in re.finditer(r&#34;\n\s*-\w+\s*--(\w+)[^=]*=\s*(\S+)&#34;,help):
    k,v = m[1], m[2]
    d[k] = coerce(v)
  d[&#34;_help&#34;] = help
  return BAG(**d)

def cli(d):
  for k,v in d.items():
    v=str(v)
    for i,x in enumerate(sys.argv):
      if (&#34;-&#34;+k[0]) == x:
         v=&#34;False&#34; if v==&#34;True&#34; else (&#34;True&#34; if v==&#34;False&#34; else sys.argv[i+1])
      d[k] = coerce(v)
  return d
#------------------------------------------------ --------- --------- ----------
def powerset(s):
  x = len(s)
  for i in range(1 &lt;&lt; x):
     if tmp :=  [s[j] for j in range(x) if (i &amp; (1 &lt;&lt; j))]:
         yield tmp
#------------------------------------------------ --------- --------- ----------
def runs(the,funs):
  the=cli(the)
  if the.help:  return yell(the._help,&#34;yellow&#34;)
  funs = [fun for fun in funs if re.match(&#34;^&#34;+the.go, fun.__name__)]
  if len(funs) &gt; 1:
    print(figfont(&#34;tests&#34;,&#34;ogre&#34;),end=&#34;&#34;)
  n = sum([run(fun,the) for fun in funs])
  if len(funs) &gt; 1:
    yell(f&#34;{n} FAILURE(S)\n&#34;,&#34;red&#34;) if n&gt;0 else yell(&#34;ALL PASSED\n&#34;,&#34;green&#34;)
  sys.exit(n)

def run(fun, settings):
  fail, cache = False, {k:settings[k] for k in settings}
  try:
    yell((fun.__name__ or &#34;fun&#34;)+&#34;\t&#34;,&#34;yellow&#34;)
    print(fun.__doc__ or &#34;&#34;,&#34; &#34;,end=&#34;&#34;)
    seed(settings.seed)
    fail = fun() == False
  except:
    fail = True
    print(traceback.format_exc())
  yell(&#34;✘\n&#34;,&#34;red&#34;) if fail else yell(&#34;✔\n&#34;,&#34;green&#34;)
  for k in cache: settings[k] = cache[k]
  return fail</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="lib.r"><code class="name flex">
<span>def <span class="ident">r</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>random() -&gt; x in the interval [0, 1).</p></div>
</dd>
<dt id="lib.figfont"><code class="name flex">
<span>def <span class="ident">figfont</span></span>(<span>txt, font)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def figfont(txt,font):
  return Figlet(font=font).renderText(txt)</code></pre>
</details>
</dd>
<dt id="lib.yell"><code class="name flex">
<span>def <span class="ident">yell</span></span>(<span>s, c)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def yell(s,c):
  print(colored(s,&#34;light_&#34;+c,attrs=[&#34;bold&#34;]),end=&#34;&#34;)</code></pre>
</details>
</dd>
<dt id="lib.showd"><code class="name flex">
<span>def <span class="ident">showd</span></span>(<span>d)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def showd(d): return &#34;{&#34;+(&#34; &#34;.join([f&#34;:{k} {show(v)}&#34;
                         for k,v in d.items() if k[0]!=&#34;_&#34;]))+&#34;}&#34;</code></pre>
</details>
</dd>
<dt id="lib.show"><code class="name flex">
<span>def <span class="ident">show</span></span>(<span>x)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def show(x):
  if callable(x)         : return x.__name__+&#39;()&#39;
  if isinstance(x,float) : return f&#34;{x:.2f}&#34;
  return x</code></pre>
</details>
</dd>
<dt id="lib.per"><code class="name flex">
<span>def <span class="ident">per</span></span>(<span>a, p=0.5, key=&lt;function &lt;lambda&gt;&gt;)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def per(a, p=.5, key=lambda x:x):
  p=int(len(a)*p); p=max(0,min(len(a)-1,p)); return key(a[p])</code></pre>
</details>
</dd>
<dt id="lib.median"><code class="name flex">
<span>def <span class="ident">median</span></span>(<span>a, key=&lt;function &lt;lambda&gt;&gt;)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def median(a, key=lambda x:x):
  return key(per(a,.5))</code></pre>
</details>
</dd>
<dt id="lib.stdev"><code class="name flex">
<span>def <span class="ident">stdev</span></span>(<span>a, key=&lt;function &lt;lambda&gt;&gt;)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stdev(a, key=lambda x:x):
  return (key(per(a,.9)) - key(per(a,.1)))/2.56</code></pre>
</details>
</dd>
<dt id="lib.ent"><code class="name flex">
<span>def <span class="ident">ent</span></span>(<span>d)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ent(d):
  n = sum(( d[k] for k in d))
  return -sum((d[k]/n*math.log(d[k]/n,2) for k in d if d[k]&gt;0))</code></pre>
</details>
</dd>
<dt id="lib.csv"><code class="name flex">
<span>def <span class="ident">csv</span></span>(<span>file)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def csv(file):
  with open(file) as fp:
    for line in fp:
      line = re.sub(r&#39;([\n\t\r&#34;\&#39; ]|#.*)&#39;, &#39;&#39;, line)
      if line:
        yield [coerce(cell.strip()) for cell in line.split(&#34;,&#34;)]</code></pre>
</details>
</dd>
<dt id="lib.coerce"><code class="name flex">
<span>def <span class="ident">coerce</span></span>(<span>x)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def coerce(x):
  if x==&#34;?&#34;: return x
  try: return ast.literal_eval(x)
  except: return x</code></pre>
</details>
</dd>
<dt id="lib.settings"><code class="name flex">
<span>def <span class="ident">settings</span></span>(<span>help, update=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Parses help string for lines with flags (on left) and defaults (on right)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def settings(help, update=False):
  &#34;Parses help string for lines with flags (on left) and defaults (on right)&#34;
  d={}
  for m in re.finditer(r&#34;\n\s*-\w+\s*--(\w+)[^=]*=\s*(\S+)&#34;,help):
    k,v = m[1], m[2]
    d[k] = coerce(v)
  d[&#34;_help&#34;] = help
  return BAG(**d)</code></pre>
</details>
</dd>
<dt id="lib.cli"><code class="name flex">
<span>def <span class="ident">cli</span></span>(<span>d)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cli(d):
  for k,v in d.items():
    v=str(v)
    for i,x in enumerate(sys.argv):
      if (&#34;-&#34;+k[0]) == x:
         v=&#34;False&#34; if v==&#34;True&#34; else (&#34;True&#34; if v==&#34;False&#34; else sys.argv[i+1])
      d[k] = coerce(v)
  return d</code></pre>
</details>
</dd>
<dt id="lib.powerset"><code class="name flex">
<span>def <span class="ident">powerset</span></span>(<span>s)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def powerset(s):
  x = len(s)
  for i in range(1 &lt;&lt; x):
     if tmp :=  [s[j] for j in range(x) if (i &amp; (1 &lt;&lt; j))]:
         yield tmp</code></pre>
</details>
</dd>
<dt id="lib.runs"><code class="name flex">
<span>def <span class="ident">runs</span></span>(<span>the, funs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def runs(the,funs):
  the=cli(the)
  if the.help:  return yell(the._help,&#34;yellow&#34;)
  funs = [fun for fun in funs if re.match(&#34;^&#34;+the.go, fun.__name__)]
  if len(funs) &gt; 1:
    print(figfont(&#34;tests&#34;,&#34;ogre&#34;),end=&#34;&#34;)
  n = sum([run(fun,the) for fun in funs])
  if len(funs) &gt; 1:
    yell(f&#34;{n} FAILURE(S)\n&#34;,&#34;red&#34;) if n&gt;0 else yell(&#34;ALL PASSED\n&#34;,&#34;green&#34;)
  sys.exit(n)</code></pre>
</details>
</dd>
<dt id="lib.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>fun, settings)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(fun, settings):
  fail, cache = False, {k:settings[k] for k in settings}
  try:
    yell((fun.__name__ or &#34;fun&#34;)+&#34;\t&#34;,&#34;yellow&#34;)
    print(fun.__doc__ or &#34;&#34;,&#34; &#34;,end=&#34;&#34;)
    seed(settings.seed)
    fail = fun() == False
  except:
    fail = True
    print(traceback.format_exc())
  yell(&#34;✘\n&#34;,&#34;red&#34;) if fail else yell(&#34;✔\n&#34;,&#34;green&#34;)
  for k in cache: settings[k] = cache[k]
  return fail</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="lib.BAG"><code class="flex name class">
<span>class <span class="ident">BAG</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>dict() -&gt; new empty dictionary
dict(mapping) -&gt; new dictionary initialized from a mapping object's
(key, value) pairs
dict(iterable) -&gt; new dictionary initialized as if via:
d = {}
for k, v in iterable:
d[k] = v
dict(**kwargs) -&gt; new dictionary initialized with the name=value pairs
in the keyword argument list.
For example:
dict(one=1, two=2)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BAG(dict):
  __getattr__ = dict.get
  __setattr__ = dict.__setitem__
  __delattr__ = dict.__delitem__
  __repr__    = showd</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.dict</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<center>
<img src="https://render.fineartamerica.com/images/rendered/default/acrylic-print/6.5/10/hangingwire/break/images-medium-5/ragworm-specimen-ucl-grant-museum-of-zoology.jpg"
width="250"><br>
</center>
<p>
The smallest brain I can imagine.
</p>
<p>
<img src="https://img.shields.io/badge/purpose-ai%20,%20se-blueviolet">
<a href="https://github.com/timm/bnbad/blob/master/LICENSE.md"><img
alt="License" src="https://img.shields.io/badge/license-bsd2-red"></a> <img alt="Python" src="https://img.shields.io/badge/python-v3.11-blue">
</p>
<div class="gcse-search" style="height: 70px"
data-as_oq="inurl:github.com/4src/ragworm"
data-gaCategoryParameter="lib">
</div>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="lib.r" href="#lib.r">r</a></code></li>
<li><code><a title="lib.figfont" href="#lib.figfont">figfont</a></code></li>
<li><code><a title="lib.yell" href="#lib.yell">yell</a></code></li>
<li><code><a title="lib.showd" href="#lib.showd">showd</a></code></li>
<li><code><a title="lib.show" href="#lib.show">show</a></code></li>
<li><code><a title="lib.per" href="#lib.per">per</a></code></li>
<li><code><a title="lib.median" href="#lib.median">median</a></code></li>
<li><code><a title="lib.stdev" href="#lib.stdev">stdev</a></code></li>
<li><code><a title="lib.ent" href="#lib.ent">ent</a></code></li>
<li><code><a title="lib.csv" href="#lib.csv">csv</a></code></li>
<li><code><a title="lib.coerce" href="#lib.coerce">coerce</a></code></li>
<li><code><a title="lib.settings" href="#lib.settings">settings</a></code></li>
<li><code><a title="lib.cli" href="#lib.cli">cli</a></code></li>
<li><code><a title="lib.powerset" href="#lib.powerset">powerset</a></code></li>
<li><code><a title="lib.runs" href="#lib.runs">runs</a></code></li>
<li><code><a title="lib.run" href="#lib.run">run</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="lib.BAG" href="#lib.BAG">BAG</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
&copy; 2023 <a href="https://timm.github.io">Tim Menzies</a>,
<a href="mailto:timm@ieee.org">timm@ieee.org</a>, BSD-2.
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>